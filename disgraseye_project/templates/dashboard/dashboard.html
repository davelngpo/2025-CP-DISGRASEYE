{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard | DisgrasEye</title>
<script src="https://cdn.tailwindcss.com"></script>
<!-- FREE Leaflet.js Map Library -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
    /* Map container styling */
    #map {
        height: 500px;
        width: 100%;
        border-radius: 12px;
        z-index: 1;
    }
    /* Custom marker colors */
    .camera-marker {
        background-color: #38BDF8;
        border: 2px solid white;
        border-radius: 50%;
    }
    .crash-marker {
        background-color: #EF4444;
        border: 2px solid white;
        border-radius: 50%;
    }
    .location-marker {
        background-color: #8B5CF6;
        border: 2px solid white;
        border-radius: 50%;
    }
    .road-label {
        background: none !important;
        border: none !important;
    }
    /* Section hiding for navigation */
    .section {
        display: none;
    }
    .section.active {
        display: block;
    }
    /* Pulse animation for crash markers */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    .pulse-marker {
        animation: pulse 2s infinite;
    }
</style>
<script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            darkblue: '#0A192F',
            sky: '#38BDF8',
            gold: '#FCD34D',
            alert: '#EF4444',
            graylight: '#CBD5E1',
            greenlight: '#22C55E',
          }
        }
      }
    }

    // Global variables
    let map;
    let markers = {
        cameras: [],
        crashes: [],
        locations: []
    };

    // Navigation functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Load initial data
        loadDashboardData();
        
        // Show dashboard by default
        showSection('dashboard');
        
        // Navigation click handlers
        document.querySelectorAll('nav a').forEach(link => {
            link.addEventListener('click', function(e) {
                if (!this.hasAttribute('href') || this.getAttribute('href') === '#') {
                    e.preventDefault();
                    const target = this.getAttribute('data-section') || 'dashboard';
                    showSection(target);
                    
                    // Update active nav item
                    document.querySelectorAll('nav a').forEach(a => {
                        a.classList.remove('bg-sky', 'hover:bg-sky/80');
                        a.classList.add('hover:bg-gray-800');
                    });
                    this.classList.add('bg-sky', 'hover:bg-sky/80');
                    this.classList.remove('hover:bg-gray-800');
                }
            });
        });

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            document.getElementById(sectionId).classList.add('active');
            
            // Initialize map if showing dashboard section
            if (sectionId === 'dashboard') {
                setTimeout(initializeMap, 100);
            }
        }

        function initializeMap() {
            // Sta. Maria, Zamboanga City coordinates
            const staMariaZamboangaCoords = [6.9915, 122.0830];
            
            // Create or recreate map
            if (map) {
                map.remove();
            }
            
            map = L.map('map').setView(staMariaZamboangaCoords, 16);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19
            }).addTo(map);

            // Clear existing markers
            clearAllMarkers();
            
            // Add real road network and locations
            addRoadNetwork();
            addRealLocations();
            
            // Crash markers will be added dynamically when data loads
        }

        function clearAllMarkers() {
            // Clear all marker groups
            Object.values(markers).forEach(markerGroup => {
                markerGroup.forEach(marker => {
                    if (map && marker) {
                        map.removeLayer(marker);
                    }
                });
            });
            // Reset markers arrays
            markers = { cameras: [], crashes: [], locations: [] };
        }

        function addRoadNetwork() {
            // Define the actual road network of Sta. Maria, Zamboanga City
            const roads = [
                {
                    name: "Sta. Maria Main Road",
                    coordinates: [
                        [6.9890, 122.0805],
                        [6.9895, 122.0810],
                        [6.9900, 122.0815],
                        [6.9905, 122.0820],
                        [6.9910, 122.0825],
                        [6.9915, 122.0830], // Central intersection
                        [6.9920, 122.0835],
                        [6.9925, 122.0840],
                        [6.9930, 122.0845],
                        [6.9935, 122.0850],
                        [6.9940, 122.0855]
                    ],
                    type: "main"
                },
                {
                    name: "Rizal Avenue",
                    coordinates: [
                        [6.9885, 122.0825],
                        [6.9890, 122.0825],
                        [6.9895, 122.0825],
                        [6.9900, 122.0825],
                        [6.9905, 122.0825],
                        [6.9910, 122.0825],
                        [6.9915, 122.0825], // Intersects with Main Road
                        [6.9920, 122.0825],
                        [6.9925, 122.0825],
                        [6.9930, 122.0825]
                    ],
                    type: "secondary"
                },
                {
                    name: "Market Road",
                    coordinates: [
                        [6.9890, 122.0840],
                        [6.9895, 122.0840],
                        [6.9900, 122.0840], // Market area
                        [6.9905, 122.0840],
                        [6.9910, 122.0840],
                        [6.9915, 122.0840], // Intersection
                        [6.9920, 122.0840]
                    ],
                    type: "secondary"
                },
                {
                    name: "School Road",
                    coordinates: [
                        [6.9910, 122.0810],
                        [6.9915, 122.0815],
                        [6.9920, 122.0820], // School area
                        [6.9925, 122.0825]
                    ],
                    type: "local"
                }
            ];

            // Draw roads on map
            roads.forEach(road => {
                const color = road.type === "main" ? '#4B5563' : 
                             road.type === "secondary" ? '#6B7280' : '#9CA3AF';
                const weight = road.type === "main" ? 8 : 
                              road.type === "secondary" ? 6 : 4;

                const polyline = L.polyline(road.coordinates, {
                    color: color,
                    weight: weight,
                    opacity: 0.9,
                    smoothFactor: 1
                }).addTo(map);

                // Add road label at midpoint
                const midIndex = Math.floor(road.coordinates.length / 2);
                const midPoint = road.coordinates[midIndex];
                
                L.marker(midPoint, {
                    icon: L.divIcon({
                        className: 'road-label',
                        html: `<div class="text-xs font-semibold bg-gray-900/80 text-white px-2 py-1 rounded border border-gray-600 backdrop-blur-sm">${road.name}</div>`,
                        iconSize: [80, 25],
                        iconAnchor: [40, 12]
                    })
                }).addTo(map);
            });

            // Add traffic cameras at key intersections
            const cameraLocations = [
                {
                    name: "Main Intersection Camera",
                    coords: [6.9915, 122.0830],
                    id: "CAM-001",
                    description: "Central Sta. Maria Intersection"
                },
                {
                    name: "Market Junction Camera",
                    coords: [6.9900, 122.0840],
                    id: "CAM-002",
                    description: "Market Road Entrance"
                },
                {
                    name: "School Zone Camera",
                    coords: [6.9920, 122.0820],
                    id: "CAM-003",
                    description: "Sta. Maria National High School"
                },
                {
                    name: "Highway Entrance Camera",
                    coords: [6.9935, 122.0850],
                    id: "CAM-004",
                    description: "Main Road Exit"
                },
                {
                    name: "Rizal Avenue Camera",
                    coords: [6.9915, 122.0825],
                    id: "CAM-005",
                    description: "Rizal Avenue Crossing"
                }
            ];

            cameraLocations.forEach(location => {
                const cameraIcon = L.divIcon({
                    className: 'camera-marker',
                    html: '<i class="fas fa-video" style="color: white; font-size: 10px;"></i>',
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });
                
                const marker = L.marker(location.coords, {icon: cameraIcon})
                    .addTo(map)
                    .bindPopup(`
                        <div class="text-sm min-w-[180px]">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-video text-sky"></i>
                                <strong>${location.name}</strong>
                            </div>
                            <div class="space-y-1 text-xs">
                                <div><span class="text-green-500">â</span> <strong>ID:</strong> ${location.id}</div>
                                <div><span class="text-green-500">â</span> <strong>Status:</strong> <span class="text-green-400">Active</span></div>
                                <div><span class="text-green-500">â</span> <strong>Location:</strong> ${location.description}</div>
                            </div>
                        </div>
                    `);
                
                markers.cameras.push(marker);
            });
        }

        function addRealLocations() {
            // Real landmarks in Sta. Maria, Zamboanga City
            const landmarks = [
                {
                    name: "Sta. Maria National High School",
                    coords: [6.9920, 122.0820],
                    type: "school",
                    icon: "fa-school",
                    description: "Public secondary school"
                },
                {
                    name: "Sta. Maria Barangay Hall",
                    coords: [6.9910, 122.0835],
                    type: "government",
                    icon: "fa-landmark",
                    description: "Local government office"
                },
                {
                    name: "Sta. Maria Health Center",
                    coords: [6.9905, 122.0845],
                    type: "hospital",
                    icon: "fa-hospital",
                    description: "Public health facility"
                },
                {
                    name: "Sta. Maria Public Market",
                    coords: [6.9900, 122.0840],
                    type: "market",
                    icon: "fa-shopping-cart",
                    description: "Local public market"
                },
                {
                    name: "Sta. Maria Church",
                    coords: [6.9918, 122.0815],
                    type: "church",
                    icon: "fa-church",
                    description: "Our Lady of Sta. Maria Parish"
                },
                {
                    name: "Zamboanga Police Station 4",
                    coords: [6.9930, 122.0840],
                    type: "police",
                    icon: "fa-shield-alt",
                    description: "Police Station serving Sta. Maria"
                },
                {
                    name: "Sta. Maria Elementary School",
                    coords: [6.9925, 122.0810],
                    type: "school",
                    icon: "fa-school",
                    description: "Public elementary school"
                },
                {
                    name: "Public Plaza",
                    coords: [6.9912, 122.0828],
                    type: "park",
                    icon: "fa-tree",
                    description: "Community public space"
                }
            ];

            landmarks.forEach(landmark => {
                const locationIcon = L.divIcon({
                    className: 'location-marker',
                    html: `<i class="fas ${landmark.icon}" style="color: white; font-size: 10px;"></i>`,
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });
                
                const marker = L.marker(landmark.coords, {icon: locationIcon})
                    .addTo(map)
                    .bindPopup(`
                        <div class="text-sm min-w-[200px]">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas ${landmark.icon} text-purple-500"></i>
                                <strong>${landmark.name}</strong>
                            </div>
                            <div class="space-y-1 text-xs">
                                <div><span class="text-blue-500">â</span> <strong>Type:</strong> ${getLocationType(landmark.type)}</div>
                                <div><span class="text-blue-500">â</span> ${landmark.description}</div>
                                <div class="text-gray-500">Sta. Maria, Zamboanga City</div>
                            </div>
                        </div>
                    `);
                
                markers.locations.push(marker);
            });
        }

        function getLocationType(type) {
            const types = {
                school: "Educational Institution",
                government: "Government Office",
                hospital: "Health Facility",
                market: "Public Market",
                church: "Religious Site",
                police: "Police Station",
                park: "Public Space"
            };
            return types[type] || "Public Facility";
        }

        function addCrashMarkers(detections) {
            // Clear existing crash markers
            markers.crashes.forEach(marker => {
                if (map && marker) {
                    map.removeLayer(marker);
                }
            });
            markers.crashes = [];
            
            // Add crash markers for detections with crashes
            const crashDetections = detections.filter(d => d.crash_detected);
            
            crashDetections.forEach((detection, index) => {
                // Place crashes along the roads (more realistic)
                const roadSegments = [
                    [6.9915, 122.0830], // Main intersection
                    [6.9900, 122.0840], // Market area
                    [6.9920, 122.0820], // School area
                    [6.9935, 122.0850], // Highway entrance
                    [6.9915, 122.0825]  // Rizal Avenue
                ];
                
                const crashCoords = roadSegments[index % roadSegments.length];
                
                const crashIcon = L.divIcon({
                    className: 'crash-marker pulse-marker',
                    html: '<i class="fas fa-car-crash" style="color: white; font-size: 10px;"></i>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                });
                
                const marker = L.marker(crashCoords, {icon: crashIcon})
                    .addTo(map)
                    .bindPopup(`
                        <div class="text-sm min-w-[220px]">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-car-crash text-red-500"></i>
                                <strong class="text-red-600">ð¨ CRASH DETECTED</strong>
                            </div>
                            <div class="space-y-1 text-xs">
                                <div><span class="text-red-500">â</span> <strong>Time:</strong> ${new Date(detection.timestamp).toLocaleString()}</div>
                                <div><span class="text-red-500">â</span> <strong>Confidence:</strong> ${detection.confidence}%</div>
                                <div><span class="text-red-500">â</span> <strong>Location:</strong> Sta. Maria Road Network</div>
                                <div><span class="text-red-500">â</span> <strong>Status:</strong> ${detection.status}</div>
                                ${detection.crash_reason ? `<div><span class="text-red-500">â</span> <strong>Reason:</strong> ${detection.crash_reason}</div>` : ''}
                            </div>
                            <div class="mt-2 p-2 bg-red-50 border border-red-200 rounded text-red-700 text-xs">
                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                Emergency services notified
                            </div>
                        </div>
                    `);
                
                markers.crashes.push(marker);
                
                // Auto-open popup for the most recent crash
                if (index === 0 && crashDetections.length > 0) {
                    setTimeout(() => {
                        marker.openPopup();
                        map.setView(crashCoords, 17);
                    }, 1500);
                }
            });
            
            // Update map legend with real counts
            updateMapLegend(crashDetections.length);
        }

        function updateMapLegend(crashCount) {
            const legendElement = document.getElementById('mapLegend');
            if (legendElement) {
                legendElement.innerHTML = `
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-sky rounded-full"></div>
                        <span>Traffic Cameras (${markers.cameras.length})</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-alert rounded-full pulse-marker"></div>
                        <span>Crash Incidents (${crashCount})</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
                        <span>Landmarks (${markers.locations.length})</span>
                    </div>
                `;
            }
        }

        function loadDashboardData() {
            // Show loading state
            document.getElementById('lastUpdate').textContent = 'Last update: Loading...';
            
            // Fetch recent detections from API
            fetch('/api/detections/')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.detections) {
                        processDashboardData(data.detections);
                        updateLastUpdateTime();
                    } else {
                        throw new Error('No detections data received');
                    }
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                    // Use fallback data
                    useFallbackData();
                });
        }

        function processDashboardData(detections) {
            // Calculate dynamic stats
            const today = new Date().toDateString();
            const accidentsToday = detections.filter(d => 
                new Date(d.timestamp).toDateString() === today && d.crash_detected
            ).length;
            
            const pendingAlerts = detections.filter(d => 
                d.crash_detected && d.status.includes('Crash Detected')
            ).length;
            
            const respondedCases = detections.filter(d => 
                d.crash_detected
            ).length - pendingAlerts;

            // Update stats cards
            document.getElementById('accidentsToday').textContent = accidentsToday;
            document.getElementById('pendingAlerts').textContent = pendingAlerts;
            document.getElementById('respondedCases').textContent = respondedCases;
            document.getElementById('activeCameras').textContent = markers.cameras.length;

            // Update recent alerts table
            updateRecentAlerts(detections);

            // Add crash markers to map
            if (map) {
                addCrashMarkers(detections);
            }

            // Store for other functions
            window.dashboardData = {
                accidentsToday,
                activeCameras: markers.cameras.length,
                pendingAlerts,
                respondedCases,
                recentDetections: detections
            };
        }

        function updateRecentAlerts(detections) {
            const tbody = document.querySelector('#recentAlertsTable tbody');
            if (tbody) {
                const recentDetections = detections.slice(0, 5); // Show last 5 detections
                
                if (recentDetections.length > 0) {
                    tbody.innerHTML = recentDetections.map(detection => `
                        <tr class="border-b border-gray-600 hover:bg-gray-600/30 transition-colors cursor-pointer" 
                            onclick="focusOnDetection(${detection.id || 'null'})">
                            <td class="py-3 px-4">${new Date(detection.timestamp).toLocaleString()}</td>
                            <td class="py-3 px-4">Sta. Maria Road Network</td>
                            <td class="py-3 px-4">
                                <span class="inline-flex px-2 py-0.5 rounded-full text-xs font-medium ${
                                    detection.crash_detected ? 'bg-alert/50 text-alert' : 'bg-greenlight/50 text-greenlight'
                                }">
                                    ${detection.crash_detected ? 'High' : 'Low'}
                                </span>
                            </td>
                            <td class="py-3 px-4 ${detection.crash_detected ? 'text-alert' : 'text-greenlight'} flex items-center gap-1">
                                <i class="fas ${detection.crash_detected ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                                ${detection.status}
                            </td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="4" class="py-8 text-center text-gray-500">
                                <i class="fas fa-info-circle text-2xl mb-2"></i><br>
                                No recent alerts found
                            </td>
                        </tr>
                    `;
                }
            }
        }

        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `Last update: ${now.toLocaleTimeString()}`;
        }

        function useFallbackData() {
            // Fallback data if API fails
            const fallbackDetections = [
                {
                    id: 1,
                    timestamp: new Date().toISOString(),
                    crash_detected: true,
                    confidence: 92,
                    status: 'Crash Detected',
                    crash_reason: 'Vehicle collision at intersection'
                },
                {
                    id: 2,
                    timestamp: new Date(Date.now() - 3600000).toISOString(),
                    crash_detected: false,
                    confidence: 85,
                    status: 'No Crash'
                },
                {
                    id: 3,
                    timestamp: new Date(Date.now() - 7200000).toISOString(),
                    crash_detected: true,
                    confidence: 88,
                    status: 'Crash Detected',
                    crash_reason: 'Multiple vehicle accident'
                }
            ];
            
            processDashboardData(fallbackDetections);
            updateLastUpdateTime();
        }

        // Auto-refresh dashboard data every 30 seconds
        setInterval(loadDashboardData, 30000);
    });

    // Global function to focus on detection in map
    function focusOnDetection(detectionId) {
        if (window.map && detectionId && window.markers.crashes.length > 0) {
            const crashMarker = window.markers.crashes[0]; // Focus on first crash
            if (crashMarker) {
                window.map.setView(crashMarker.getLatLng(), 17);
                crashMarker.openPopup();
            }
        }
    }

    // Make functions globally available
    window.initializeMap = initializeMap;
    window.loadDashboardData = loadDashboardData;
    window.focusOnDetection = focusOnDetection;
</script>
</head>
<body class="bg-darkblue text-graylight font-sans">

<!-- Header -->
<header class="flex justify-between items-center p-4 bg-[#091527] border-b border-sky/30">
    <h1 class="text-xl font-bold text-sky flex items-center gap-2">
        <i class="fas fa-exclamation-triangle text-alert"></i> DisgrasEye Dashboard
    </h1>
    <div class="flex items-center gap-4">
        <span class="text-sm text-gray-400" id="lastUpdate">Last update: Loading...</span>
        <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="bg-alert hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </form>
    </div>
</header>

<div class="flex flex-col lg:flex-row min-h-screen">

    <!-- Sidebar -->
    <aside class="w-full lg:w-64 bg-[#0F172A] p-4 lg:min-h-screen">
        <nav class="flex flex-row lg:flex-col gap-2 lg:gap-4 overflow-x-auto lg:overflow-x-visible">
            <a href="#" data-section="dashboard" class="flex items-center px-4 py-2 bg-sky rounded-lg hover:bg-sky/80 transition">
                <i class="fas fa-home mr-3"></i><span class="hidden sm:inline">Dashboard</span>
            </a>
            <a href="{% url 'demo' %}" class="flex items-center px-4 py-2 hover:bg-gray-800 rounded-lg transition">
                <i class="fas fa-satellite-dish mr-3"></i><span class="hidden sm:inline">Live Detection</span>
            </a>
            <a href="#" data-section="reports" class="flex items-center px-4 py-2 hover:bg-gray-800 rounded-lg transition">
                <i class="fas fa-chart-bar mr-3"></i><span class="hidden sm:inline">Reports</span>
            </a>
            <a href="#" data-section="cameras" class="flex items-center px-4 py-2 hover:bg-gray-800 rounded-lg transition">
                <i class="fas fa-video mr-3"></i><span class="hidden sm:inline">Cameras</span>
            </a>
            <a href="#" data-section="settings" class="flex items-center px-4 py-2 hover:bg-gray-800 rounded-lg transition">
                <i class="fas fa-cog mr-3"></i><span class="hidden sm:inline">Settings</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 lg:p-8 bg-[#112240]">
        
        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-[#1E293B] p-6 rounded-xl shadow hover:shadow-lg transition transform hover:-translate-y-1">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-400">Accidents Today</p>
                            <h2 class="text-3xl font-bold text-sky mt-2" id="accidentsToday">0</h2>
                        </div>
                        <div class="bg-sky/20 p-3 rounded-lg">
                            <i class="fas fa-car-crash text-sky text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-[#1E293B] p-6 rounded-xl shadow hover:shadow-lg transition transform hover:-translate-y-1">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-400">Active Cameras</p>
                            <h2 class="text-3xl font-bold text-gold mt-2" id="activeCameras">0</h2>
                        </div>
                        <div class="bg-gold/20 p-3 rounded-lg">
                            <i class="fas fa-video text-gold text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-[#1E293B] p-6 rounded-xl shadow hover:shadow-lg transition transform hover:-translate-y-1">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-400">Pending Alerts</p>
                            <h2 class="text-3xl font-bold text-alert mt-2" id="pendingAlerts">0</h2>
                        </div>
                        <div class="bg-alert/20 p-3 rounded-lg">
                            <i class="fas fa-exclamation-circle text-alert text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-[#1E293B] p-6 rounded-xl shadow hover:shadow-lg transition transform hover:-translate-y-1">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-400">Responded Cases</p>
                            <h2 class="text-3xl font-bold text-greenlight mt-2" id="respondedCases">0</h2>
                        </div>
                        <div class="bg-greenlight/20 p-3 rounded-lg">
                            <i class="fas fa-check-circle text-greenlight text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map Section -->
            <div class="bg-[#1E293B] rounded-xl shadow overflow-hidden mb-8">
                <div class="p-6 border-b border-gray-600 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-map-marked-alt text-sky"></i>
                        <h3 class="text-xl font-bold">Sta. Maria, Zamboanga City - Road Network</h3>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="initializeMap()" class="text-sm bg-sky hover:bg-sky/80 text-white px-3 py-1 rounded transition flex items-center gap-1">
                            <i class="fas fa-sync-alt"></i> Refresh Map
                        </button>
                        <span class="bg-greenlight/20 text-greenlight text-xs px-2 py-1 rounded-full flex items-center gap-1">
                            <i class="fas fa-circle animate-pulse"></i> Live
                        </span>
                    </div>
                </div>
                <div class="p-4">
                    <div id="map"></div>
                    <div class="flex flex-wrap gap-4 mt-4 text-sm" id="mapLegend">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-sky rounded-full"></div>
                            <span>Traffic Cameras (5)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-alert rounded-full"></div>
                            <span>Crash Incidents (0)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
                            <span>Landmarks (8)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Alerts Table -->
            <div class="bg-[#1E293B] rounded-xl shadow overflow-hidden">
                <div class="p-6 border-b border-gray-600 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-calendar-alt text-sky"></i>
                        <h3 class="text-xl font-bold">Recent Detection Alerts</h3>
                    </div>
                    <button onclick="loadDashboardData()" class="text-sm bg-sky hover:bg-sky/80 text-white px-3 py-1 rounded transition flex items-center gap-1">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left" id="recentAlertsTable">
                        <thead class="bg-[#112240]">
                            <tr>
                                <th class="py-3 px-4">Date & Time</th>
                                <th class="py-3 px-4">Location</th>
                                <th class="py-3 px-4">Severity</th>
                                <th class="py-3 px-4">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" class="py-8 text-center text-gray-500">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i><br>
                                    Loading detection data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section">
            <div class="mb-6">
                <h2 class="text-2xl font-bold flex items-center gap-2">
                    <i class="fas fa-chart-bar text-sky"></i> Analytics & Reports
                </h2>
                <p class="text-gray-400 mt-2">Comprehensive crash detection analytics and performance reports</p>
            </div>
            <div class="bg-[#1E293B] rounded-xl p-6 text-center">
                <i class="fas fa-chart-line text-4xl text-gray-500 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-400">Reports Section</h3>
                <p class="text-gray-500 mt-2">Analytics and reporting features coming soon...</p>
            </div>
        </div>

        <!-- Cameras Section -->
        <div id="cameras" class="section">
            <div class="mb-6">
                <h2 class="text-2xl font-bold flex items-center gap-2">
                    <i class="fas fa-video text-sky"></i> Camera Management
                </h2>
                <p class="text-gray-400 mt-2">Monitor and manage all CCTV cameras in the system</p>
            </div>
            <div class="bg-[#1E293B] rounded-xl p-6 text-center">
                <i class="fas fa-video text-4xl text-gray-500 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-400">Camera Management</h3>
                <p class="text-gray-500 mt-2">Camera management features coming soon...</p>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="section">
            <div class="mb-6">
                <h2 class="text-2xl font-bold flex items-center gap-2">
                    <i class="fas fa-cog text-sky"></i> System Settings
                </h2>
                <p class="text-gray-400 mt-2">Configure system preferences and user management</p>
            </div>
            <div class="bg-[#1E293B] rounded-xl p-6 text-center">
                <i class="fas fa-cogs text-4xl text-gray-500 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-400">System Settings</h3>
                <p class="text-gray-500 mt-2">System configuration features coming soon...</p>
            </div>
        </div>

    </main>
</div>
</body>
</html>