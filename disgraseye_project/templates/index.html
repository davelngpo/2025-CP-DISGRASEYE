{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DisgrasEye - AI-Powered Crash Detection System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-slow { animation: pulse-slow 2s ease-in-out infinite; }
        
        @keyframes slide-up {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-up { animation: slide-up 0.6s ease-out; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #0A192F 0%, #1E3A8A 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .video-player {
            width: 100%;
            border-radius: 12px;
            background: #000;
        }
    </style>
    <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                darkblue: '#0A192F',
                sky: '#38BDF8',
                gold: '#FCD34D',
                alert: '#EF4444',
                graylight: '#CBD5E1',
                greenlight: '#22C55E',
                darkbg: '#112240',
                cardbg: '#1E293B'
              }
            }
          }
        }
    </script>
</head>
<body class="bg-darkblue text-graylight font-sans">

    <!-- Header -->
    <header class="flex justify-between items-center p-4 bg-[#091527] border-b border-sky/30">
        <h1 class="text-xl font-bold text-sky flex items-center gap-2">
            <i class="fas fa-exclamation-triangle text-alert"></i> DisgrasEye
        </h1>
        <div class="flex gap-4">
            <a href="{% url 'dashboard' %}" class="bg-sky hover:bg-sky/80 text-white px-4 py-2 rounded-lg transition flex items-center gap-2">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <form action="{% url 'logout' %}" method="post" class="inline">
                {% csrf_token %}
                <button type="submit" class="bg-alert hover:bg-red-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </form>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="gradient-bg min-h-screen flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 opacity-10">
            <div class="absolute w-96 h-96 bg-sky rounded-full -top-48 -left-48 pulse-slow"></div>
            <div class="absolute w-96 h-96 bg-alert rounded-full -bottom-48 -right-48 pulse-slow" style="animation-delay: 1s;"></div>
        </div>
        
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center text-white slide-up">
                <h1 class="text-5xl md:text-7xl font-bold mb-6">DisgrasEye</h1>
                <p class="text-xl md:text-2xl mb-8 font-light text-graylight">AI-Powered CCTV System for Real-Time Vehicle Crash Detection and Alerting</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="#demo" class="bg-sky hover:bg-sky/80 text-white px-8 py-4 rounded-lg font-semibold transition-all transform hover:scale-105 shadow-lg flex items-center gap-2">
                        <i class="fas fa-satellite-dish"></i> Try Live Demo
                    </a>
                    <a href="#overview" class="glass-effect text-white px-8 py-4 rounded-lg font-semibold hover:bg-white/20 transition-all flex items-center gap-2">
                        <i class="fas fa-info-circle"></i> Learn More
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Overview Section -->
    <section id="overview" class="py-20 bg-darkbg">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center mb-12 text-white">System Overview</h2>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-cardbg p-8 rounded-xl shadow-lg transform hover:scale-105 transition-all border border-sky/20">
                    <div class="text-4xl mb-4 text-sky"><i class="fas fa-video"></i></div>
                    <h3 class="text-xl font-bold mb-3 text-white">Real-Time Detection</h3>
                    <p class="text-graylight">Process CCTV footage in real-time using advanced YOLOv8 computer vision algorithms</p>
                </div>
                <div class="bg-cardbg p-8 rounded-xl shadow-lg transform hover:scale-105 transition-all border border-alert/20">
                    <div class="text-4xl mb-4 text-alert"><i class="fas fa-exclamation-triangle"></i></div>
                    <h3 class="text-xl font-bold mb-3 text-white">Instant Alerts</h3>
                    <p class="text-graylight">Automatically notify traffic authorities and emergency services when crashes are detected</p>
                </div>
                <div class="bg-cardbg p-8 rounded-xl shadow-lg transform hover:scale-105 transition-all border border-greenlight/20">
                    <div class="text-4xl mb-4 text-greenlight"><i class="fas fa-chart-bar"></i></div>
                    <h3 class="text-xl font-bold mb-3 text-white">Analytics Dashboard</h3>
                    <p class="text-graylight">Track detection history, confidence scores, and system performance metrics</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Live Detection Demo -->
    <section id="demo" class="py-20 bg-darkblue">
        <div class="container mx-auto px-4 max-w-4xl">
            <h2 class="text-4xl font-bold text-center mb-12 text-white">Live Detection Demo</h2>
            
            <div class="bg-cardbg rounded-2xl shadow-2xl p-8 border border-gray-600">
                <!-- Upload Area -->
                <div id="uploadArea" class="border-4 border-dashed border-gray-600 rounded-xl p-12 text-center mb-6 hover:border-sky transition-all cursor-pointer">
                    <input type="file" id="fileInput" accept="image/*,video/*" class="hidden">
                    <div class="text-6xl mb-4 text-sky"><i class="fas fa-cloud-upload-alt"></i></div>
                    <p class="text-xl font-semibold text-graylight mb-2">Click or drag to upload</p>
                    <p class="text-gray-400">Support: Images (JPG, PNG) or Videos (MP4, AVI)</p>
                </div>

                <!-- Processing Status -->
                <div id="processingStatus" class="hidden mb-6">
                    <div class="bg-sky/20 border border-sky rounded-lg p-4 flex items-center">
                        <svg class="animate-spin h-5 w-5 mr-3 text-sky" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-sky font-semibold">Analyzing with YOLOv8...</span>
                    </div>
                </div>

                <!-- Results Area -->
                <div id="resultsArea" class="hidden">
                    <div id="resultAlert" class="rounded-lg p-6 mb-6"></div>
                    
                    <!-- Media Preview Container -->
                    <div class="mb-6">
                        <!-- Color Legend -->
                        <div class="bg-gray-900 p-4 rounded-t-lg border-b-2 border-sky">
                            <p class="text-white text-sm font-semibold mb-2"><i class="fas fa-palette mr-2"></i>Bounding Box Color Guide:</p>
                            <div class="flex flex-wrap gap-4 text-sm">
                                <span class="text-greenlight flex items-center gap-1"><i class="fas fa-square"></i> Green = Normal Vehicles</span>
                                <span class="text-alert flex items-center gap-1"><i class="fas fa-square"></i> Red = Crash Detected</span>
                            </div>
                            <p class="text-gray-400 text-xs mt-2">Each vehicle type has different shade of green when normal</p>
                        </div>
                        
                        <div id="imagePreview" class="hidden">
                            <img id="resultImage" class="w-full rounded-b-lg shadow-lg" alt="Detection Result">
                        </div>
                        <div id="videoPreview" class="hidden video-container">
                            <video id="resultVideo" class="video-player" controls>
                                Your browser does not support the video tag.
                            </video>
                        </div>
                    </div>

                    <!-- Detection Details -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-darkbg p-4 rounded-lg border border-gray-600">
                            <p class="text-gray-400 text-sm mb-1"><i class="fas fa-info-circle mr-2"></i>Status</p>
                            <p id="detectionStatus" class="text-xl font-bold text-white"></p>
                        </div>
                        <div class="bg-darkbg p-4 rounded-lg border border-gray-600">
                            <p class="text-gray-400 text-sm mb-1"><i class="fas fa-chart-line mr-2"></i>Confidence</p>
                            <p id="detectionConfidence" class="text-xl font-bold text-sky"></p>
                        </div>
                        <div class="bg-darkbg p-4 rounded-lg border border-gray-600">
                            <p class="text-gray-400 text-sm mb-1"><i class="fas fa-car mr-2"></i>Vehicles Detected</p>
                            <p id="vehicleCount" class="text-xl font-bold text-white"></p>
                        </div>
                        <div class="bg-darkbg p-4 rounded-lg border border-gray-600">
                            <p class="text-gray-400 text-sm mb-1"><i class="fas fa-fingerprint mr-2"></i>Detection ID</p>
                            <p id="detectionId" class="text-xl font-bold text-white"></p>
                        </div>
                        <div class="bg-darkbg p-4 rounded-lg border border-gray-600 md:col-span-2">
                            <p class="text-gray-400 text-sm mb-1"><i class="fas fa-clock mr-2"></i>Timestamp</p>
                            <p id="detectionTimestamp" class="text-lg font-semibold text-white"></p>
                        </div>
                        <div class="bg-darkbg p-4 rounded-lg border border-gray-600 md:col-span-2" id="crashReasonContainer">
                            <p class="text-gray-400 text-sm mb-1"><i class="fas fa-search mr-2"></i>Detection Details</p>
                            <p id="detectionDetails" class="text-lg font-semibold text-white"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Recent Detections -->
    <section class="py-20 bg-darkbg">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center mb-12 text-white">Recent Detections</h2>
            
            <div class="max-w-4xl mx-auto">
                <div id="detectionLogs" class="space-y-4">
                    <!-- Logs will be populated by JavaScript -->
                    <div class="bg-cardbg p-8 rounded-xl shadow-md text-center border border-gray-600">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2 text-sky"></i><br>
                        <p class="text-gray-400">Loading recent detections...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Team Info -->
    <section class="py-20 bg-darkblue">
        <div class="container mx-auto px-4 text-center">
            <h2 class="text-4xl font-bold mb-6 text-white">Developed By</h2>
            <p class="text-xl text-gray-400 mb-8">Information Technology Students</p>
            <p class="text-lg text-graylight">University Research Project</p>
        </div>
    </section>

    <script>
        // File Upload Handling
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const processingStatus = document.getElementById('processingStatus');
        const resultsArea = document.getElementById('resultsArea');
        const imagePreview = document.getElementById('imagePreview');
        const videoPreview = document.getElementById('videoPreview');
        const resultVideo = document.getElementById('resultVideo');

        // Recent Detections with pagination
        let currentOffset = 0;
        const detectionsPerPage = 5;

        uploadArea.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-sky');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-sky');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-sky');
            const file = e.dataTransfer.files[0];
            if (file) processFile(file);
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) processFile(file);
        });

        function processFile(file) {
            // Check file type
            const isVideo = file.type.startsWith('video/');
            const isImage = file.type.startsWith('image/');
            
            if (!isVideo && !isImage) {
                alert('Please upload an image or video file.');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            // Show processing status
            processingStatus.classList.remove('hidden');
            resultsArea.classList.add('hidden');
            imagePreview.classList.add('hidden');
            videoPreview.classList.add('hidden');

            // AJAX request to Django backend
            fetch('/detect/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                }
            })
            .then(response => response.json())
            .then(data => {
                processingStatus.classList.add('hidden');
                displayResults(data, isVideo);
            })
            .catch(error => {
                console.error('Error:', error);
                processingStatus.classList.add('hidden');
                alert('Detection failed. Please try again.');
            });
        }

        function displayResults(data, isVideo) {
            resultsArea.classList.remove('hidden');
            
            const resultAlert = document.getElementById('resultAlert');
            const isCrash = data.crash_detected;
            
            resultAlert.className = `rounded-lg p-6 mb-6 ${isCrash ? 'bg-alert/20 border-2 border-alert' : 'bg-greenlight/20 border-2 border-greenlight'}`;
            resultAlert.innerHTML = `
                <div class="flex items-center">
                    <span class="text-4xl mr-4">${isCrash ? 'üö®' : '‚úÖ'}</span>
                    <div>
                        <h3 class="text-2xl font-bold ${isCrash ? 'text-alert' : 'text-greenlight'} mb-1">
                            ${isCrash ? 'Crash Detected!' : 'No Crash Detected'}
                        </h3>
                        <p class="${isCrash ? 'text-alert' : 'text-greenlight'}">
                            ${isCrash ? 'Emergency services have been notified' : 'All vehicles are operating normally'}
                        </p>
                        ${data.crash_reason ? `<p class="text-sm mt-2 ${isCrash ? 'text-alert' : 'text-greenlight'}">Reason: ${data.crash_reason}</p>` : ''}
                    </div>
                </div>
            `;

            document.getElementById('detectionStatus').textContent = data.status;
            document.getElementById('detectionConfidence').textContent = data.confidence + '%';
            document.getElementById('detectionTimestamp').textContent = new Date(data.timestamp).toLocaleString();
            document.getElementById('vehicleCount').textContent = data.vehicle_count || 0;
            document.getElementById('detectionId').textContent = data.detection_id || 'N/A';
            
            // Show detection details
            const detectionDetails = document.getElementById('detectionDetails');
            const crashReasonContainer = document.getElementById('crashReasonContainer');
            
            if (data.crash_reason) {
                detectionDetails.textContent = data.crash_reason;
                crashReasonContainer.classList.remove('hidden');
            } else {
                detectionDetails.textContent = `Vehicles detected: ${data.vehicle_count || 0}`;
                crashReasonContainer.classList.remove('hidden');
            }
            
            // Show appropriate media preview
            if (data.image_path) {
                // Use the is_video flag from the response
                const isVideoResult = data.is_video;
                
                if (isVideoResult) {
                    // Show VIDEO player
                    console.log('Showing video:', data.image_path);
                    videoPreview.classList.remove('hidden');
                    imagePreview.classList.add('hidden');
                    
                    // Clear previous video source
                    resultVideo.src = '';
                    
                    // Set new video source
                    resultVideo.src = data.image_path;
                    
                    // Add event listeners for better error handling
                    resultVideo.onloadeddata = function() {
                        console.log('Video loaded successfully');
                    };
                    
                    resultVideo.onerror = function() {
                        console.error('Error loading video:', data.image_path);
                        videoPreview.classList.add('hidden');
                        alert('Error loading video. The file format might not be supported.');
                    };
                    
                    // Load the video
                    resultVideo.load();
                    resultVideo.controls = true;
                    
                } else {
                    // Show IMAGE
                    console.log('Showing image:', data.image_path);
                    imagePreview.classList.remove('hidden');
                    videoPreview.classList.add('hidden');
                    
                    const resultImage = document.getElementById('resultImage');
                    resultImage.onerror = function() {
                        console.error('Error loading image:', data.image_path);
                        imagePreview.classList.add('hidden');
                        alert('Error loading image.');
                    };
                    
                    resultImage.src = data.image_path;
                }
            } else {
                // No media available
                imagePreview.classList.add('hidden');
                videoPreview.classList.add('hidden');
            }
            
            // Reload recent detections to include the new one
            currentOffset = 0;
            loadRecentDetections();
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function loadRecentDetections(append = false) {
            fetch(`/api/detections/?limit=${detectionsPerPage}&offset=${currentOffset}`)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('detectionLogs');
                    
                    if (data.detections && data.detections.length > 0) {
                        const detectionsHTML = data.detections.map(detection => {
                            // Use the is_video flag from the API response
                            const isVideo = detection.is_video;
                            
                            return `
                            <div class="bg-cardbg p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow cursor-pointer border border-gray-600" 
                                 onclick="viewDetection(${detection.id}, '${detection.image_path}', ${isVideo})">
                                <div class="flex justify-between items-start mb-3">
                                    <span class="${detection.crash_detected ? 'bg-alert/50 text-alert' : 'bg-greenlight/50 text-greenlight'} px-3 py-1 rounded-full text-sm font-semibold">
                                        ${detection.status}
                                    </span>
                                    <span class="text-gray-400 text-sm">${new Date(detection.timestamp).toLocaleString()}</span>
                                </div>
                                <p class="text-graylight mb-2">Detection ID: #${detection.id}</p>
                                <div class="flex gap-4 text-sm text-gray-400 mb-3">
                                    <span>Confidence: <strong class="text-white">${detection.confidence}%</strong></span>
                                    <span>Vehicles: <strong class="text-white">${detection.vehicle_count || 0}</strong></span>
                                    <span>Response: <strong class="${detection.crash_detected ? 'text-alert' : 'text-greenlight'}">${detection.crash_detected ? 'Alerted' : 'Monitoring'}</strong></span>
                                </div>
                                ${detection.image_path ? `
                                <div class="mt-3 relative group">
                                    ${isVideo ? `
                                        <div class="relative">
                                            <video class="w-full h-48 object-cover rounded-lg border-2 border-gray-600" muted playsinline preload="metadata">
                                                <source src="${detection.image_path}" type="video/mp4">
                                                Your browser does not support the video tag.
                                            </video>
                                            <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 rounded-lg">
                                                <span class="text-white text-4xl">‚ñ∂Ô∏è</span>
                                            </div>
                                            <span class="absolute top-2 right-2 bg-sky text-white px-2 py-1 rounded text-xs font-semibold">VIDEO</span>
                                        </div>
                                    ` : `
                                        <div class="relative">
                                            <img src="${detection.image_path}" alt="Detection result" 
                                                 class="w-full h-48 object-cover rounded-lg border-2 border-gray-600"
                                                 onerror="this.style.display='none'">
                                            <span class="absolute top-2 right-2 bg-greenlight text-white px-2 py-1 rounded text-xs font-semibold">IMAGE</span>
                                        </div>
                                    `}
                                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded-lg flex items-center justify-center">
                                        <span class="text-white font-semibold opacity-0 group-hover:opacity-100 transition-opacity">Click to View</span>
                                    </div>
                                </div>
                                ` : `
                                <div class="mt-3 p-4 bg-darkbg rounded-lg text-center border border-gray-600">
                                    <p class="text-gray-400">No media available</p>
                                </div>
                                `}
                            </div>
                        `;
                        }).join('');
                        
                        if (append) {
                            container.innerHTML += detectionsHTML;
                        } else {
                            container.innerHTML = detectionsHTML;
                        }
                        
                        // Add Load More button if there are more detections
                        if (data.has_more && (currentOffset + detectionsPerPage) < 10) {
                            const loadMoreBtn = document.getElementById('loadMoreBtn');
                            if (!loadMoreBtn) {
                                const btnHTML = `
                                    <div class="text-center mt-6" id="loadMoreBtnContainer">
                                        <button id="loadMoreBtn" onclick="loadMoreDetections()" 
                                                class="bg-sky hover:bg-sky/80 text-white px-6 py-3 rounded-lg font-semibold transition-all transform hover:scale-105">
                                            Load More Detections
                                        </button>
                                    </div>
                                `;
                                container.insertAdjacentHTML('afterend', btnHTML);
                            }
                        } else {
                            const loadMoreBtn = document.getElementById('loadMoreBtnContainer');
                            if (loadMoreBtn) {
                                loadMoreBtn.remove();
                            }
                        }
                    } else if (!append) {
                        container.innerHTML = `
                            <div class="bg-cardbg p-6 rounded-xl shadow-md text-center border border-gray-600">
                                <p class="text-gray-400">No detections yet. Upload an image or video to get started!</p>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    console.error('Error loading detections:', error);
                    if (!append) {
                        document.getElementById('detectionLogs').innerHTML = `
                            <div class="bg-cardbg p-6 rounded-xl shadow-md text-center border border-gray-600">
                                <p class="text-alert">Error loading recent detections</p>
                            </div>
                        `;
                    }
                });
        }

        function loadMoreDetections() {
            currentOffset += detectionsPerPage;
            loadRecentDetections(true);
        }

        function viewDetection(id, mediaPath, isVideo) {
            // Create modal to view detection
            const modal = document.createElement('div');
            modal.id = 'detectionModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-cardbg rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-auto p-6 relative border border-gray-600">
                    <button onclick="closeDetectionModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-3xl font-bold bg-darkbg rounded-full w-10 h-10 flex items-center justify-center shadow-lg border border-gray-600">
                        √ó
                    </button>
                    <h2 class="text-2xl font-bold mb-4 text-white">Detection #${id}</h2>
                    <div class="mb-4">
                        ${isVideo ? `
                            <video controls autoplay class="w-full rounded-lg shadow-lg" playsinline>
                                <source src="${mediaPath}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        ` : `
                            <img src="${mediaPath}" alt="Detection #${id}" class="w-full rounded-lg shadow-lg">
                        `}
                    </div>
                    <div class="bg-darkbg p-4 rounded-lg text-center border border-gray-600">
                        <p class="text-sm text-gray-400">Click outside or press √ó to close</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeDetectionModal();
                }
            });
        }

        function closeDetectionModal() {
            const modal = document.getElementById('detectionModal');
            if (modal) {
                // Stop any playing videos before removing
                const video = modal.querySelector('video');
                if (video) {
                    video.pause();
                    video.currentTime = 0;
                }
                modal.remove();
            }
        }

        // Load recent detections when page loads
        document.addEventListener('DOMContentLoaded', () => {
            currentOffset = 0;
            loadRecentDetections();
        });
    </script>
</body>
</html>